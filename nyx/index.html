<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      background-image: linear-gradient(#311b92, #000);
      user-select: none;
    }
  </style>
  <title>nyxLamp Control Panel</title>
</head>

<body>
  <nav>
    <div class="nav-wrapper deep-purple darken-4">
      <div style="text-align: center; font-size:2rem; font-weight: 700; letter-spacing: 2px;">Lamp Control</div>
    </div>
  </nav>
  <br><br>
  <div class="container">
    <div class="row">
      <div class="col s12">
        <div id="color" class="z-depth-5" style="transition: background 0.5s ease; background:white; margin: auto; width: 200px; height: 200px; border-radius:50%;"></div>
      </div>
    </div>
    <div class="row">
      <div class="col s12">
          <p class="range-field">
            <label class="white-text">Red</label>
            <input oninput="sliderColor()" class="transition: all 0.5s;" type="range" id="red" min="0" max="255" value="255">
          </p>
          <p class="range-field">
            <label class="white-text">Green</label>
            <input oninput="sliderColor()" class="transition: all 0.5s;" type="range" id="green" min="0" max="255" value="255">
          </p>
          <p class="range-field">
            <label class="white-text">Blue</label>
            <input oninput="sliderColor()" class="transition: all 0.5s;" type="range" id="blue" min="0" max="255" value="255">
          </p>
      </div>
    </div>
    <div class="row">
      <div class="col s12 white-text">Color Presents</div>
    </div>
    <div class="row">
      <div class="col s4"><div onclick="changeColor('#ffffff')" style="width:100%; text-align: center" class="chip white">White</div></div>
      <div class="col s4"><div onclick="changeColor('#e1f5fe')" style="width:100%; text-align: center" class="chip blue lighten-5">Clear sky</div></div>
      <div class="col s4"><div onclick="changeColor('#000000')" style="width:100%; text-align: center" class="chip white-text black">Black</div></div>
    </div>
    <div class="row">
      <div class="col s4"><div onclick="changeColor('#fffde7')" style="width:100%; text-align: center" class="chip yellow lighten-5">Candle</div></div>
      <div class="col s4"><div onclick="changeColor('#ffe082')" style="width:100%; text-align: center" class="chip amber lighten-3">Halogen</div></div>
      <div class="col s4"><div onclick="changeColor('#8bc34a')" style="width:100%; text-align: center" class="chip light-green">Nature</div></div>
      <!-- <div class="col s4"><div style="width:100%; text-align: center" class="chip">Tungsten</div></div> -->
    </div>
    <div class="row">
      <div class="col s4"><div onclick="changeColor('#f44336')" style="width:100%; text-align: center" class="chip white-text red">Red</div></div>
      <div class="col s4"><div onclick="changeColor('#4caf50')" style="width:100%; text-align: center" class="chip green">Green</div></div>
      <div class="col s4"><div onclick="changeColor('#3f51b5')" style="width:100%; text-align: center" class="chip indigo white-text">Blue</div></div>
    </div>
  </div>
  <iframe src="http://192.168.4.1/Black" style="display:none"></iframe>
  <script>
    var currentColor = '#000000';

    function rgbToHex(r, g, b) {
      return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function hexToRgb(hex) {
      var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
      } : null;
    }

    function changeColor(hex){
      document.getElementById("color").style.background = hex;
      document.getElementById("red").value = hexToRgb(hex).r;
      document.getElementById("green").value = hexToRgb(hex).g;
      document.getElementById("blue").value = hexToRgb(hex).b;
      switch(hex){
        case '#ffffff':
          callColorChange("White");
          break;
        case '#e1f5fe':
          callColorChange("Sky")
          break;
        case '#000000':
          callColorChange("Black")
          break;
        case '#fffde7':
          callColorChange("Candle")
          break;
        case '#ffe082':
          callColorChange("Halogen")
          break;
        case '#8bc34a':
          callColorChange("Nature")
          break;
        case '#f44336':
          callColorChange("Red")
          break;
        case '#4caf50':
          callColorChange("Green")
          break;
        case '#3f51b5':
          callColorChange("Blue")
          break;
      }
    }

    function sliderColor(){
      ;
      document.getElementById("color").style.background = `rgb(${document.getElementById("red").value}, ${document.getElementById("green").value}, ${document.getElementById("blue").value})`;
    }

    function callColorChange(color){
      var xhr = new XMLHttpRequest();
      xhr.open('GET', `http://192.168.4.1/${color}`, true);
      xhr.onload = function() {
        console.log(xhr.response)
      };
      xhr.send();
    }
  </script>
</body>

</html>